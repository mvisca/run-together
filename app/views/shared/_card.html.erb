<% user = User.find(@race.user_id) %>
<div class="col col-sm-12 col-md-6 col-xl-4">
    <div class="card text-center rt-color-dark rt-rounded rt-shadow pb-2 m-3">

        <% if @race.geocoded? %>
          <% lat = @race.latitude %>
          <% lng = @race.longitude %>
            <img src="https://api.mapbox.com/styles/v1/mapbox/streets-v11/static/<%= @race.longitude %>,<%= @race.latitude %>,15.20,0,60/600x300?access_token=pk.eyJ1IjoibWFydGludmlzY2EiLCJhIjoiY2t2NTN4aDIyMTJsNzJ2czNtYTZjb2V4OSJ9.CLbr0RseY-VgYAST2mjDOA" class="rt-rounded-top"/>
        <% else %>
          <img src="https://images.unsplash.com/photo-1607962837359-5e7e89f86776" alt="Runners photo" class="rt-rounded-top">
        <% end %>

        <div class="card-body">
          <h5 class="card-title text-center rt-hili-brand-title"><%= @race.name  %></h5>

          <div class="rt-hili-owner-block">
            <div class="rt-hili-small">
              <p>Created by:</p>
            </div>
            <div>
              <% if user.photo.key %>
                <%= cl_image_tag user.photo.key,
                  height: 150,
                  width: 150,
                  gravity: :face,
                  crop: :fill,
                  class: 'rt-owner-avatar rt-shadow rt-rounded' %>
              <% else %>
                <%= image_tag "logo.png",
                  alt:"RunTogether logo",
                  class: "rt-owner-avatar rt-shadow",
                  style: "background-color: black; image-size: cover;" %>
              <% end %>
            </div>
            <div class="rt-hili-owner-intro">
              <p><%= user.name.split[0] %></p>
            </div>
          </div>

          <div class="rt-hili rt-rounded">
            <div class="rt-hili-container">
              <div class="rt-hili-center">
                <p class="rt-hili-brand">Date</p>
                <p class="rt-hili-p-join rt-hili-small"><%= @race.start_date.strftime("%d %b")%></p>
                <p class="rt-hili-p-join rt-hili-small"><%= "#{@race.start_date.hour}:#{@race.start_date.min.to_s.length > 1 ? @race.start_date.min : '0' + @race.start_date.min.to_s }" %></p>
              </div>
              <div class="rt-hili-line"></div>
              <div class="rt-hili-center">
                <p class="rt-hili-brand">Distance</p>
                <p class="rt-hili-data"><%= @race.length %> K</p>
              </div>
              <div class="rt-hili-line"></div>
              <div class="rt-hili-center">
                <p class="rt-hili-brand">Runners</p>
                <p class="rt-hili-data"><%= Runner.where(race_id: @race.id).count() %></p>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col">
              <%= link_to "More info", race_path(@race), class: "btn rt-btn rt-hili-brand" %>
            </div>
          </div>
        </div>
    </div>
  </div>



